<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <style>
        body {
            background-color: black;
            color: white;
            transform: scale(0.85);
        }
        .invalid {
            font-size:1rem;
            color:wheat;
        }
        .card {
            background-color: red;
            color: white;
            transform: scale(0.85);
        }
        .card-body {
            background-color: #b30000;
        }
        .form-label {
            color: white;
        }
        .btn-primary {
            background-color: #b30000;
            border: none;
        }
        .btn-primary:hover {
            background-color: #ff0000;
        }
        .link-secondary {
            color: white;
        }
        .link-secondary:hover {
            text-decoration: underline;
        }
        .error, .login {
            color: white;
            background-color: #8B0000;
            padding: 10px;
            border-radius: 5px;
        }
        .signup-link {
            color: white;
            display: block;
            text-align: center;
            margin-top: 20px;
        }
        .signup-link a {
            color: #ff6666;
        }
        .signup-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<!-- Login Form -->
<section class="bg-dark p-3 p-md-4 p-xl-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-9 col-lg-7 col-xl-6 col-xxl-5">
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-3 p-md-4 p-xl-5">
                        <div class="row">
                            <div class="col-12">
                                <div class="mb-5">
                                    <h3 class="text-white">LOGIN PAGE</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Login Form -->
                        <div class="row">
                            <div class="col-12">
                                <p class="mt-5 mb-4">Already a member? Log in with email</p>
                                <form id="loginForm" action="/users/login" method="POST">
                                    <div class="row gy-3 overflow-hidden">
                                        <div class="col-12">
                                            <div class="form-floating mb-3">
                                                <input type="email" class="form-control" name="email" id="email" placeholder="name@example.com" required>
                                                <label for="email" class="form-label">Email</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-floating mb-3">
                                                <input type="password" class="form-control" name="password" id="password" placeholder="Password" required>
                                                <label for="password" class="form-label">Password</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="d-grid">
                                                <button class="btn btn-primary" id="btn-login" type="submit">Log in now</button>
                                            </div>
                                            <br>
                                            <a href="#!" class="link-secondary text-decoration-none">Forgot password? Reset password</a>
                                        </div>
                                    </div>
                                </form>

                                <!-- Error or success message handling -->
                                <div  class="error mt-4 invalid" style="display: none;">
                                    <p>Invalid credentials. Please try again.</p>
                                </div>

                                <div class="login mt-4" style="display: none;">
                                    <p>Welcome back! You are now logged in.</p>
                                </div>

                                <!-- Sign up link -->
                                <div class="signup-link">
                                    <p>Not a member? <a href= "http://localhost:3000/users/signup" class="link-secondary">Sign up</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>

document.getElementById('login-Form').addEventListener('submit', async function(event) {
   event.preventDefault(); // Prevent default form submission

    
    const formData = new FormData(event.target);
    const data = {
        email: formData.get('email'),
        password: formData.get('password').trim(),
    };

    
    try {
        const response = await fetch('http://localhost:3000/users/login', {
            method: 'POST', 
            headers: {
                'Content-Type': 'application/json', 
            },
            body: JSON.stringify(data) 
           
        });

     
        if (response.ok) {
            // If login is successful, redirect to the members page
            window.location.href = 'http://localhost:3000/users/members';  
        } else {
            // If login fails, show an alert with the error message
            const result = await response.json();
            document.getElementById('login-fail').innerHTML = `Donn√©es invalides, veuillez recommencer`;
            //alert(result.message || 'Login failed');
        }

    } catch (error) {
        console.error('Error during login:', error);
        console.log(data);
        alert('An error occurred during login. Please try again.');
    }
});


</script>
</body>
</html>
